---
layout: post

title: "Building gitea for Raspberry Pi 4 (arm7l)"
subtitle: "fixes arm7l issues"
excerpt: "This article explains how to build gitea on your local Raspberry Pi 4 and fixing the arm7l release issues."
image: "/img/image/ps-journey.jpg"
show-avatar: true
category: ["Resources"]
tags: ["gitea", "docker", "docker-compose"]
comments: true
social-links: true
googlefonts: ["Share+Tech+Mono"]
---

{% include about.html footer=true readingtime=true %}

##  The Background

While working with a Raspberry Pi 4 for evaluate software or running your home automation you often ran into the
following scenario:

You a looking for a specific software and try to avoid following complex install instructions. So you decide looking
for a containerized version on docker hub like now with the [gitea image](https://hub.docker.com/r/gitea/gitea).

But unfortunately you ran into errors because there is no image for your current cpu architecture. This is because
most of the available free build services offer a `amd64` or even `arm64` based build environment.

Unfortunately Rasbian Buster is still 32bit and your Raspberry Pi reports the cpu arch like this:

```bash
~> uname -m
arm7l

~> cat /proc/cpuinfo | grep "model name"
model name      : ARMv7 Processor rev 3 (v7l)

```

So the only way to fix this is to build the container image by yourself...

## Preparing your system

I assume you've already installed the `docker engine` and `docker-compose`. If not so, simply use the
[Convenience Script](https://docs.docker.com/engine/install/ubuntu/#install-using-the-convenience-script) and
[docker-compose](https://docs.docker.com/compose/install/#install-compose-on-linux-systems) install instruction.

## Using docker-compose file

Now all you have to do using a docker-compose file which automatically pulls the sources and builds the image on
your system

```bash
~> cd ~
~> mkdir gitea
~> touch docker-compose.yml
~> vim docker-compose.yml
```

- docker-compose.yml

```yml
version: '3'
services:
  gitea:
    container_name: gitea
    build:
      context: https://github.com/go-gitea/gitea.git#release/v1.11
    image: ocram85/gitea.1.11
    environment:
      - USER_UID=1000
      - USER_GID=1000
      - DB_TYPE=postgres
      - DB_NAME=gitea
      - DB_USER=gitea
      - DB_PASSWD=gitea
    restart: unless-stopped
    depends_on:
      - gitea_db
    volumes:
      - ./volumes/gitea/data:/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "3000:3000"
      - "222:22"
  gitea_db:
    image: postgres:9.6
    container_name: gitea_db
    restart: unless-stopped
    environment:
      - POSTGRES_USER=gitea
      - POSTGRES_PASSWORD=gitea
      - POSTGRES_DB=gitea
    volumes:
      - ./volumes/gitea/postgres:/var/lib/postgresql/data
```

{: .box-warning}
<i class="fa fa-bolt icon-yellow" aria-hidden="true"></i> **Environment values**: Don't forget to replace the
environment values `DB_*`, `POSTGRES_*` and the `gitea image` name!

The `context` value defines the build source. I personally like working with the latest stable version instead of
following the `master` branch. So the git url postfix `release/v1.11` simply tells docker to pull from this branch.

![gitea-branch](/img/posts/gitea-branch.png)

Now we can simply create the image and starting the container like this:

```bash
# 1. compile gitea and create the image
~> docker-compose build gitea
# 2. start the environment with its containers
~> docker-compose up -d
```
